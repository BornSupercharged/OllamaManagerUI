{% extends "base.html" %}

{% block content %}
<!-- Server Status -->
<div class="server-status-container">
    <el-alert
        :title="serverStatusMessage"
        :type="serverStatus ? 'success' : 'error'"
        show-icon>
    </el-alert>
</div>

<!-- Header -->
<el-card>
    <h1 class="text-center">Gestionnaire de Modèles Ollama</h1>
</el-card>

<!-- Content Grid -->
<el-row :gutter="20">
    <!-- Pull Model Form -->
    <el-col :span="12">
        <el-card class="box-card">
            <div slot="header">
                <span>Télécharger un Nouveau Modèle</span>
            </div>
            <el-input
                v-model="modelName"
                placeholder="Entrez le nom du modèle (ex: llama2:7b)">
                <el-button slot="append" type="primary" @click="pullModel">
                    Télécharger
                </el-button>
            </el-input>
            <el-progress
                v-if="showProgress"
                :percentage="downloadProgress"
                :status="progressStatus">
            </el-progress>
            <!-- Search Results -->
            <div v-show="showSearchResults" class="search-results">
                <el-card v-for="model in searchResults" :key="model.name">
                    <div class="model-item">
                        <span>{% raw %}{{ model.name }}{% endraw %}</span>
                        <div class="model-tags">
                            <el-button
                                v-for="tag in model.tags"
                                :key="tag"
                                size="mini"
                                @click="selectModel(`${model.name}:${tag}`)">
                                {% raw %}{{ tag }}{% endraw %}
                            </el-button>
                        </div>
                    </div>
                </el-card>
            </div>
        </el-card>
    </el-col>

    <!-- Overall Usage Statistics -->
    <el-col :span="12">
        <el-card class="box-card">
            <div slot="header">
                <span>Statistiques Globales d'Utilisation</span>
            </div>
            <el-row :gutter="20" class="statistics-grid">
                <el-col :span="12" v-for="stat in overallStats" :key="stat.label">
                    <div class="statistic-item">
                        <div class="value">{% raw %}{{ stat.value }}{% endraw %}</div>
                        <div class="label">{% raw %}{{ stat.label }}{% endraw %}</div>
                    </div>
                </el-col>
            </el-row>
        </el-card>
    </el-col>
</el-row>

<!-- Models Sections -->
<el-row>
    <!-- Local Models -->
    <el-col :span="24">
        <el-card class="box-card">
            <div slot="header" class="clearfix">
                <span>Modèles Locaux</span>
                <el-button-group style="float: right">
                    <el-button type="danger" @click="batchDeleteModels">
                        <i class="el-icon-delete"></i> Supprimer la Sélection
                    </el-button>
                    <el-button type="primary" @click="batchConfigureModels">
                        <i class="el-icon-setting"></i> Configurer la Sélection
                    </el-button>
                    <el-button type="info" @click="compareSelectedModels">
                        <i class="el-icon-sort"></i> Comparer la Sélection
                    </el-button>
                    <el-button @click="toggleAllModels">
                        <i class="el-icon-check"></i> Tout Sélectionner
                    </el-button>
                    <el-button @click="refreshLocalModels">
                        <i class="el-icon-refresh"></i> Actualiser
                    </el-button>
                </el-button-group>
            </div>
            <el-table
                ref="localModelsTable"
                :data="localModels"
                @selection-change="handleSelectionChange">
                <el-table-column type="selection" width="55"></el-table-column>
                <el-table-column prop="name" label="Nom du Modèle"></el-table-column>
                <el-table-column prop="modified_at" label="Date de Modification">
                    <template slot-scope="scope">
                        {% raw %}{{ formatDate(scope.row.modified_at) }}{% endraw %}
                    </template>
                </el-table-column>
                <el-table-column prop="size" label="Taille">
                    <template slot-scope="scope">
                        {% raw %}{{ formatBytes(scope.row.size) }}{% endraw %}
                    </template>
                </el-table-column>
                <el-table-column prop="details.format" label="Format"></el-table-column>
                <el-table-column prop="details.family" label="Famille"></el-table-column>
                <el-table-column prop="details.parameter_size" label="Paramètres"></el-table-column>
                <el-table-column label="Actions" width="300">
                    <template slot-scope="scope">
                        <el-button-group>
                            <el-button size="mini" @click="showModelConfig(scope.row.name)">
                                <i class="el-icon-setting"></i>
                            </el-button>
                            <el-button size="mini" type="info" @click="showModelStats(scope.row.name)">
                                <i class="el-icon-data-line"></i>
                            </el-button>
                            <el-button size="mini" type="danger" @click="deleteModel(scope.row.name)">
                                <i class="el-icon-delete"></i>
                            </el-button>
                        </el-button-group>
                    </template>
                </el-table-column>
            </el-table>
        </el-card>
    </el-col>

    <!-- Running Models -->
    <el-col :span="24" style="margin-top: 20px;">
        <el-card class="box-card">
            <div slot="header" class="clearfix">
                <span>Modèles en Cours d'Exécution</span>
                <el-button style="float: right" @click="refreshRunningModels">
                    <i class="el-icon-refresh"></i> Actualiser
                </el-button>
            </div>
            <el-table :data="runningModels">
                <el-table-column prop="name" label="Nom du Modèle"></el-table-column>
                <el-table-column prop="modified_at" label="Date de Modification">
                    <template slot-scope="scope">
                        {% raw %}{{ formatDate(scope.row.modified_at) }}{% endraw %}
                    </template>
                </el-table-column>
                <el-table-column prop="size" label="Taille">
                    <template slot-scope="scope">
                        {% raw %}{{ formatBytes(scope.row.size) }}{% endraw %}
                    </template>
                </el-table-column>
                <el-table-column prop="details.format" label="Format"></el-table-column>
                <el-table-column prop="details.family" label="Famille"></el-table-column>
                <el-table-column prop="details.parameter_size" label="Paramètres"></el-table-column>
                <el-table-column label="Actions" width="120">
                    <template slot-scope="scope">
                        <el-button type="danger" size="mini" @click="stopModel(scope.row.name)">
                            <i class="el-icon-video-pause"></i> Arrêter
                        </el-button>
                    </template>
                </el-table-column>
            </el-table>
        </el-card>
    </el-col>
</el-row>

{% include 'modals/settings.html' %}
{% include 'modals/stats.html' %}
{% include 'modals/config.html' %}
{% include 'modals/batch_results.html' %}
{% include 'modals/message.html' %}

<!-- Model Comparison Dialog -->
<el-dialog title="Comparaison de Modèles" :visible.sync="comparisonDialogVisible" fullscreen>
    <div class="comparison-container">
        <el-row :gutter="20">
            <el-col :span="12" v-for="model in selectedModels" :key="model.name">
                <el-card class="box-card">
                    <div slot="header">
                        <span>{% raw %}{{ model.name }}{% endraw %}</span>
                    </div>
                    <div class="model-details">
                        <!-- Model comparison content -->
                    </div>
                </el-card>
            </el-col>
        </el-row>
    </div>
</el-dialog>
{% endblock %}
